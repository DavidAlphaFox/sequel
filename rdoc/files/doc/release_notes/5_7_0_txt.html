<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
<head>
<title>5.7.0.txt</title>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<link href='../../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
<script type='text/javascript'>
  function popupCode(url) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }
  
  function toggleCode(id) {
    var code = document.getElementById(id)
  
    code.style.display = code.style.display != 'block' ? 'block' : 'none'
    return true
  }
  
  // Make codeblocks hidden by default
  document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
</script>
</head>
<body class='page'>
<div class='file' id='wrapper'>
<div class='header'>
<h1 class='name'>5.7.0.txt
</h1>
<div class='paths'>
doc/release_notes/5.7.0.txt
</div>
<div class='last-update'>
Last Update:
<span class='datetime'>2018-04-01 19:38:21 -0700</span>
</div>
</div>
<div id='content'>
<div id='text'>
<div id='description'>
<h1 id="label-New+Features">New Features<span><a href="#label-New+Features">&para;</a> <a href="#top">&uarr;</a></span></h1>
<ul><li>
<p>An integer64 extension has been added, which treats the Integer class as a generic 64-bit integer type.  Sequel’s default behavior for Integer is to use the integer type, which on most databases is a 32-bit type.</p>

<p>This affects all internal use of the Integer class as a generic database type, so that methods like primary_key and foreign_key also default to using a 64-bit integer type when using this extension.</p>
</li><li>
<p>When using PostgreSQL 10+, you can use the :identity option when creating columns to create identity columns:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>.<span class="ruby-identifier">create_table</span>(<span class="ruby-value">:table</span>){<span class="ruby-constant">Integer</span> <span class="ruby-value">:id</span>, <span class="ruby-value">identity:</span> <span class="ruby-keyword">true</span>}
<span class="ruby-comment"># CREATE TABLE &quot;table&quot; (&quot;id&quot; integer GENERATED BY DEFAULT AS IDENTITY)</span>
</pre>

<p>If you want to disallow using a user provided value when inserting, or updating you can use a value of :always:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>.<span class="ruby-identifier">create_table</span>(<span class="ruby-value">:table</span>){<span class="ruby-constant">Integer</span> <span class="ruby-value">:id</span>, <span class="ruby-value">identity:</span> <span class="ruby-value">:always</span>}
<span class="ruby-comment"># CREATE TABLE &quot;table&quot; (&quot;id&quot; integer GENERATED ALWAYS AS IDENTITY)</span>
</pre>
</li><li>
<p>Database#convert_serial_to_identity has been added on PostgreSQL 10.2+. This method can convert existing serial columns to identity columns in most cases, but it currently requires superuser permissions as it modifies the system tables directly.</p>
</li><li>
<p>Dataset#overriding_system_value and overriding_user_value are now supported on PostgreSQL to work with identity columns.  You can use overriding_system_value to force the use of a user provided value for identity columns that are GENERATED ALWAYS, and you can use overriding_user_value to ignore any user value for identity columns and always use the next entry in the sequence.</p>
</li></ul>

<h1 id="label-Other+Improvements">Other Improvements<span><a href="#label-Other+Improvements">&para;</a> <a href="#top">&uarr;</a></span></h1>
<ul><li>
<p>On PostgreSQL 10.2+, identity columns are now used instead of serial columns as the default for auto incrementing primary keys:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>.<span class="ruby-identifier">create_table</span>(<span class="ruby-value">:table</span>){<span class="ruby-identifier">primary_key</span> <span class="ruby-value">:id</span>}

<span class="ruby-comment"># Sequel 5.7.0+ and PostgreSQL 10.2+</span>
<span class="ruby-comment"># CREATE TABLE &quot;table&quot; (&quot;id&quot; integer</span>
<span class="ruby-comment">#   GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY)</span>

<span class="ruby-comment"># Older Sequel version or older PostgreSQL version</span>
<span class="ruby-comment"># CREATE TABLE &quot;table&quot; (&quot;id&quot; serial PRIMARY KEY)</span>
</pre>

<p>Identity columns fix many issues that serial columns have, in addition to being the SQL standard way to support auto incrementing columns.</p>
</li><li>
<p>PostgreSQL identity columns are now correctly recognized and the :auto_increment schema entry is now populated for them.</p>
</li><li>
<p>Dataset#with_sql_{all,each,first,single_value} now use a cached dataset to avoid clobbering the current dataset’s columns. Previously, the clobbering of the current dataset’s columns was documented and the method warned against using SQL with different columns.  These methods are now safe to use in such cases, but will not have the same performance advantages if the current dataset is not cached.</p>
</li><li>
<p>On ruby 2.1+, <a href="../../../classes/Sequel.html"><code>Sequel</code></a> now uses Process::CLOCK_MONOTONIC when performing elapsed time calculations so that it is not affected by modifications to the system’s time.</p>
</li><li>
<p>In the postgres adapter, prepared statement errors related to changing types are now treated as disconnect errors. While they are not technically disconnect errors, treating them as such will in general reduce the total number of exceptions generated from 1 per affected statement per connection to 1 per connection.</p>
</li><li>
<p>In the pg_array_associations plugin, the array_type for pg_array_to_many and many_to_pg_array association reflections is now always the scalar type for the array (e.g. integer). Previously, the array type (e.g. integer[]) was used in some cases.  This didn’t previously result in issues as PostgreSQL considers <a href="">integer[]</a> the same type as integer[].</p>
</li><li>
<p>In the pg_array_associations plugin, the many_to_pg_array association remove_all_* method now uses the appropriate cast to work for non-integer array types such as bigint[].</p>
</li><li>
<p>Database#server_version on PostgreSQL 10.1+ now works correctly when the connection does not support the server_version method. Now the server_version_num database setting is always used to ensure consistent behavior across adapters.</p>
</li><li>
<p>In the jdbc/oracle adapter, temporary clobs are now manually freed to prevent a memory leak, in line with the Oracle JDBC driver recommendations.</p>
</li><li>
<p>The <a href="../../../classes/Sequel.html"><code>Sequel</code></a> &lt;4 release notes and changelog are no longer shipped with the gem, decreasing the size of the gem by 20%.</p>
</li></ul>

<h1 id="label-Backwards+Compatibility">Backwards Compatibility<span><a href="#label-Backwards+Compatibility">&para;</a> <a href="#top">&uarr;</a></span></h1>
<ul><li>
<p>The switch to using identity columns instead of serial columns by default on PostgreSQL 10.2+ may break backwards compatibilty in some situations, such as code that relies on what are generally considered bugs in serial columns, such as CREATE TABLE LIKE using the same sequence for the column in both the existing table and the new table, or that dropping the default value for the column does not drop the related sequence.</p>
</li></ul>
</div>
<div id='context'>
</div>

</div>
</div>

<div id='footer-push'></div>
</div>
<div id='footer'>
<a href="https://github.com/jeremyevans/hanna-nouveau"><strong>Hanna Nouveau</strong> RDoc template</a>
</div>
</body>
</html>
