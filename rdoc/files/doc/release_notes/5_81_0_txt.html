<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
<head>
<title>5.81.0.txt</title>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<link href='../../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
<script type='text/javascript'>
  function popupCode(url) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }
  
  function toggleCode(id) {
    var code = document.getElementById(id)
  
    code.style.display = code.style.display != 'block' ? 'block' : 'none'
    return true
  }
  
  // Make codeblocks hidden by default
  document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
</script>
</head>
<body class='page'>
<div class='file' id='wrapper'>
<div class='header'>
<h1 class='name'>5.81.0.txt
</h1>
<div class='paths'>
doc/release_notes/5.81.0.txt
</div>
</div>
<div id='content'>
<div id='text'>
<div id='description'>
<h1 id="label-New+Features">New Features<span><a href="#label-New+Features">&para;</a> <a href="#top">&uarr;</a></span></h1>
<ul><li>
<p>A temporarily_release_connection Database extension has been added, designed for multithreaded transactional testing.</p>

<p>This allows one thread to start a transaction, and then release the connection back for usage by the connection pool, so that other threads can operate on the connection object safely inside the transaction.  This requires the connection pool be limited to a single connection, to ensure that the released connection can be reacquired.  Itâ€™s not perfect, because if the connection is disconnected and removed from the pool while temporarily released, there is no way to handle that situation correctly. Example:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>.<span class="ruby-identifier">transaction</span>(<span class="ruby-value">rollback:</span> <span class="ruby-value">:always</span>, <span class="ruby-value">auto_savepoint:</span> <span class="ruby-keyword">true</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">conn</span><span class="ruby-operator">|</span>
  <span class="ruby-constant">DB</span>.<span class="ruby-identifier">temporarily_release_connection</span>(<span class="ruby-identifier">conn</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-comment"># Other threads can operate on connection safely inside</span>
    <span class="ruby-comment"># the transaction</span>
    <span class="ruby-keyword">yield</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>
</li></ul>

<h1 id="label-Other+Improvements">Other Improvements<span><a href="#label-Other+Improvements">&para;</a> <a href="#top">&uarr;</a></span></h1>
<ul><li>
<p>In the caller_logging and provenance extensions, Ruby internal caller locations are skipped when trying to locate the appropriate caller line to include.</p>
</li><li>
<p>A couple ignored block warnings in plugin apply methods have been fixed on Ruby 3.4.</p>
</li></ul>
</div>
<div id='context'>
</div>

</div>
</div>

<div id='footer-push'></div>
</div>
<div id='footer'>
<a href="https://github.com/jeremyevans/hanna"><strong>Hanna</strong> RDoc template</a>
</div>
</body>
</html>
