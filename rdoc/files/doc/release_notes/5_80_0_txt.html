<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
<head>
<title>5.80.0.txt</title>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<link href='../../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
<script type='text/javascript'>
  function popupCode(url) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }
  
  function toggleCode(id) {
    var code = document.getElementById(id)
  
    code.style.display = code.style.display != 'block' ? 'block' : 'none'
    return true
  }
  
  // Make codeblocks hidden by default
  document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
</script>
</head>
<body class='page'>
<div class='file' id='wrapper'>
<div class='header'>
<h1 class='name'>5.80.0.txt
</h1>
<div class='paths'>
doc/release_notes/5.80.0.txt
</div>
</div>
<div id='content'>
<div id='text'>
<div id='description'>
<h1 id="label-New+Features">New Features<span><a href="#label-New+Features">&para;</a> <a href="#top">&uarr;</a></span></h1>
<ul><li>
<p>A provenance dataset extension has been added. This extension makes SQL queries include a comment describing how the dataset was built. This can make debugging complex cases significantly easier. Here’s a simple example:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>.<span class="ruby-identifier">extension</span> <span class="ruby-value">:provenance</span>

<span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].
  <span class="ruby-identifier">select</span>(<span class="ruby-value">:a</span>).
  <span class="ruby-identifier">where</span>{<span class="ruby-identifier">b</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">10</span>}.
  <span class="ruby-identifier">order</span>(<span class="ruby-value">:c</span>).
  <span class="ruby-identifier">limit</span>(<span class="ruby-value">10</span>)
  <span class="ruby-comment"># SQL:</span>
  <span class="ruby-comment"># SELECT a FROM table WHERE (b &gt; 10) ORDER BY c LIMIT 10 --</span>
  <span class="ruby-comment">#  -- Dataset Provenance</span>
  <span class="ruby-comment">#  -- Keys:[:from] Source:(eval at bin/sequel:257):2:in `&lt;main&gt;&#39;</span>
  <span class="ruby-comment">#  -- Keys:[:select] Source:(eval at bin/sequel:257):3:in `&lt;main&gt;&#39;</span>
  <span class="ruby-comment">#  -- Keys:[:where] Source:(eval at bin/sequel:257):4:in `&lt;main&gt;&#39;</span>
  <span class="ruby-comment">#  -- Keys:[:order] Source:(eval at bin/sequel:257):5:in `&lt;main&gt;&#39;</span>
  <span class="ruby-comment">#  -- Keys:[:limit] Source:(eval at bin/sequel:257):6:in `&lt;main&gt;&#39;</span>
</pre>

<p>With the above example, it’s obvious how the dataset is created, but but in real applications, where datasets can be built from multiple files, seeing where each dataset clone was made can be helpful.</p>

<p>The source listed will skip locations in the Ruby standard library as well as <a href="../../../classes/Sequel.html"><code>Sequel</code></a> itself.  Other locations can be skipped by providing a Database :provenance_caller_ignore Regexp option:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>.<span class="ruby-identifier">opts</span>[<span class="ruby-value">:provenance_caller_ignore</span>] = <span class="ruby-regexp">/\/gems\/library_name-/</span>
</pre>
</li></ul>

<h1 id="label-Other+Improvements">Other Improvements<span><a href="#label-Other+Improvements">&para;</a> <a href="#top">&uarr;</a></span></h1>
<ul><li>
<p>For dataset methods where <a href="../../../classes/Sequel.html"><code>Sequel</code></a> can determine that the return value would be equivalent to the receiver, <a href="../../../classes/Sequel.html"><code>Sequel</code></a> now returns the receiver.  This reduces the number of dataset allocations.</p>
</li><li>
<p><a href="../../../classes/Sequel.html"><code>Sequel</code></a> now supports Dataset#skip_locked on MariaDB 10.6+.</p>
</li></ul>
</div>
<div id='context'>
</div>

</div>
</div>

<div id='footer-push'></div>
</div>
<div id='footer'>
<a href="https://github.com/jeremyevans/hanna"><strong>Hanna</strong> RDoc template</a>
</div>
</body>
</html>
