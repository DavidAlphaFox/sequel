<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
<head>
<title>5.76.0.txt</title>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<link href='../../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
<script type='text/javascript'>
  function popupCode(url) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }
  
  function toggleCode(id) {
    var code = document.getElementById(id)
  
    code.style.display = code.style.display != 'block' ? 'block' : 'none'
    return true
  }
  
  // Make codeblocks hidden by default
  document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
</script>
</head>
<body class='page'>
<div class='file' id='wrapper'>
<div class='header'>
<h1 class='name'>5.76.0.txt
</h1>
<div class='paths'>
doc/release_notes/5.76.0.txt
</div>
<div class='last-update'>
Last Update:
<span class='datetime'>2024-01-01 08:48:15 -0800</span>
</div>
</div>
<div id='content'>
<div id='text'>
<div id='description'>
<h1 id="label-New+Features">New Features<span><a href="#label-New+Features">&para;</a> <a href="#top">&uarr;</a></span></h1>
<ul><li>
<p>An auto_cast_date_and_time extension has been added, which will automatically cast date and time values using SQL standard functions. This makes sure the database will treat the value as a date, time, or timestamp, instead of treating it as a string or unknown type:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>.<span class="ruby-identifier">get</span>(<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>).<span class="ruby-identifier">class</span>
<span class="ruby-comment"># SELECT &#39;2024-01-01&#39; AS v LIMIT 1</span>
<span class="ruby-constant">String</span>

<span class="ruby-constant">DB</span>.<span class="ruby-identifier">extension</span>(<span class="ruby-value">:auto_cast_date_and_time</span>)
<span class="ruby-constant">DB</span>.<span class="ruby-identifier">get</span>(<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>).<span class="ruby-identifier">class</span>
<span class="ruby-comment"># SELECT DATE &#39;2024-01-01&#39; AS v LIMIT 1</span>
<span class="ruby-constant">Date</span>
</pre>

<p>This was already Sequelâ€™s default behavior on adapters that required it.  This extension is usable on PostgreSQL and MySQL.  It is not usable on SQLite (no date/time types) or Microsoft SQL Server (no support for the SQL standard conversion syntax).</p>

<p>This extension can break code that currently works. If using it on PostgreSQL, it will cast the values to TIMESTAMP, not TIMESTAMP WITH TIME ZONE, which can break code that depended on an implicit conversion to TIMESTAMP WITH TIME ZONE.  The pg_timestamptz extension integrates with the the auto_cast_date_and_time extension and will implicitly cast Time/DateTime to TIMESTAMP WITH TIME ZONE.</p>
</li><li>
<p>The sqlite adapter now supports a :cached value for the :setup_regexp_function Database option, which will cache regexp values instead of creating a new regexp per value to compare.  This is much faster when using a regexp comparison on a large dataset, but can result in a memory leak if using dynamic regexps. You can also provide a Proc value for the :setup_regexp_function option, which will be passed both the regexp source string and the database string to compare, and should return whether the database string matches the regexp string.</p>
</li><li>
<p>The rcte_tree plugin now supports a :union_all option, which can be set to false to use UNION instead of UNION ALL in the recursive common table expression.</p>
</li></ul>

<h1 id="label-Other+Improvements">Other Improvements<span><a href="#label-Other+Improvements">&para;</a> <a href="#top">&uarr;</a></span></h1>
<ul><li>
<p>Time/DateTime/SQLite literalization speed has more than doubled compared to the previous version.  The internal code is also much simpler, as the speedup resulted from removing multiple abstraction layers that mostly existed for Ruby 1.8 support.</p>
</li><li>
<p>Database#table_exists? on PostgreSQL now handles lock or statement timeout errors as evidence the table exists.</p>
</li><li>
<p>The round_timestamps extension now correctly rounds SQLTime values on Microsoft SQL Server (the only database <a href="../../../classes/Sequel.html"><code>Sequel</code></a> supports where time precision is different than timestamp precision).</p>
</li><li>
<p>Fractional times and timestamps are now supported on SQLAnywhere, except for time values when using the jdbc adapter due to a limitation in the JDBC sqlanywhere driver.</p>
</li><li>
<p>Database#tables and views on PostgreSQL now supports SQL::Identifier values for the :schema option.</p>
</li><li>
<p>The named_timezones extension now works around a bug in DateTime.jd on JRuby.</p>
</li></ul>

<h1 id="label-Backwards+Compatibility">Backwards Compatibility<span><a href="#label-Backwards+Compatibility">&para;</a> <a href="#top">&uarr;</a></span></h1>
<ul><li>
<p>Time/DateTime/SQLTime literalization internals have changed. If you are using an external adapter and the external adapter overrides or calls any of the following methods:</p>
<ul><li>
<p>requires_sql_standard_datetimes?</p>
</li><li>
<p>supports_timestamp_usecs?</p>
</li><li>
<p>supports_timestamp_timezones?</p>
</li><li>
<p>timestamp_precision</p>
</li><li>
<p>sqltime_precision</p>
</li></ul>

<p>then the adapter may need to be updated to support <a href="../../../classes/Sequel.html"><code>Sequel</code></a> 5.76.0. Additionally, if the adapter uses %N or %z in default_timestamp_format, it may need to be updated. Adapters should now just override default_timestamp_format and/or default_time_format methods as appropriate for the database.</p>
</li><li>
<p>The Dataset#format_timestamp_offset private method has been removed.</p>
</li></ul>
</div>
<div id='context'>
</div>

</div>
</div>

<div id='footer-push'></div>
</div>
<div id='footer'>
<a href="https://github.com/jeremyevans/hanna"><strong>Hanna</strong> RDoc template</a>
</div>
</body>
</html>
