<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
<head>
<title>5.52.0.txt</title>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<link href='../../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
<script type='text/javascript'>
  function popupCode(url) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }
  
  function toggleCode(id) {
    var code = document.getElementById(id)
  
    code.style.display = code.style.display != 'block' ? 'block' : 'none'
    return true
  }
  
  // Make codeblocks hidden by default
  document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
</script>
</head>
<body class='page'>
<div class='file' id='wrapper'>
<div class='header'>
<h1 class='name'>5.52.0.txt
</h1>
<div class='paths'>
doc/release_notes/5.52.0.txt
</div>
<div class='last-update'>
Last Update:
<span class='datetime'>2021-12-30 13:02:13 -0800</span>
</div>
</div>
<div id='content'>
<div id='text'>
<div id='description'>
<h1 id="label-New+Features">New Features<span><a href="#label-New+Features">&para;</a> <a href="#top">&uarr;</a></span></h1>
<ul><li>
<p>When the sql_comments Database extension is used, Database#with_comments is now added, which can be used for including comments for all queries executed inside a given block.  This can be useful if you want to analyze database query logs, and want to group all related queries:</p>

<pre class="ruby"> <span class="ruby-constant">DB</span>.<span class="ruby-identifier">with_comments</span>(<span class="ruby-value">model:</span> <span class="ruby-constant">Album</span>, <span class="ruby-value">action:</span> <span class="ruby-value">:all</span>) <span class="ruby-keyword">do</span>
   <span class="ruby-constant">DB</span>[<span class="ruby-value">:albums</span>].<span class="ruby-identifier">all</span>
   <span class="ruby-comment"># SELECT * FROM albums -- model:Album,action:all</span>
<span class="ruby-keyword">end</span>
</pre>
</li><li>
<p>An sql_comments plugin has been added, which will automatically add SQL comments for all queries generated by model class, instance and dataset methods:</p>

<pre class="ruby"><span class="ruby-constant">Album</span>.<span class="ruby-identifier">plugin</span> <span class="ruby-value">:sql_comments</span>

<span class="ruby-identifier">album</span> = <span class="ruby-constant">Album</span>[<span class="ruby-value">1</span>]
<span class="ruby-comment"># SELECT * FROM albums WHERE (id = 1) LIMIT 1</span>
<span class="ruby-comment"># -- model:Album,method_type:class,method:[]</span>

<span class="ruby-identifier">album</span>.<span class="ruby-identifier">update</span>(<span class="ruby-value">:name</span><span class="ruby-operator">=&gt;</span><span class="ruby-string">&#39;A&#39;</span>)
<span class="ruby-comment"># UPDATE albums SET name = &#39;baz&#39; WHERE (id = 1)</span>
<span class="ruby-comment"># -- model:Album,method_type:instance,method:update</span>

<span class="ruby-constant">Album</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">id:</span> <span class="ruby-value">1</span>).<span class="ruby-identifier">delete</span>
<span class="ruby-comment"># DELETE FROM albums WHERE (id = 1)</span>
<span class="ruby-comment"># -- model:Album,method_type:dataset,method:delete</span>
</pre>

<p>This plugin requires you have loaded the sql_comments Database extension into the related Database before use.</p>
</li><li>
<p>A date_parse_input_handler extension has been added to support custom handling of input to date parsing methods.  Among other things, you can use this to limit the length of strings that will be parsed, which can prevent ArgumentErrors in newer Ruby versions:</p>

<pre class="ruby"><span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">extension</span> <span class="ruby-value">:date_parse_input_handler</span>
<span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">date_parse_input_handler</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">string</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">string</span>.<span class="ruby-identifier">b</span>[<span class="ruby-value">0</span>, <span class="ruby-value">128</span>]
<span class="ruby-keyword">end</span>
</pre>
</li></ul>

<h1 id="label-Other+Improvements">Other Improvements<span><a href="#label-Other+Improvements">&para;</a> <a href="#top">&uarr;</a></span></h1>
<ul><li>
<p>On Ruby 3.1, the core_refinements extension now avoids the deprecated Refinement#include, switching to Refinement#import_methods.</p>
</li><li>
<p>On Ruby 3.1, the subclasses plugin will use Ruby’s native support for Class#subclasses.</p>
</li><li>
<p>The subclasses plugin has renamed descendents to descendants and freeze_descendents to freeze_descendants.  The previous method names are still available as aliases.</p>
</li><li>
<p>The :ruby_default schema entry for datetime/timestamp columns now respects Sequel.datetime_class.  Previously, the value for the :ruby_default schema entry would always be a DateTime value for such columns.</p>
</li><li>
<p>The pg_interval extension now works with ActiveSupport 7.0.</p>
</li><li>
<p>The shared postgres adapter now respects Database#default_string_column_size for setting the size of string columns that don’t use text as the database type.</p>
</li><li>
<p>Database#supports_check_constraints? now returns true on MySQL 8.0.19+. This fixes drop_constraint in certain cases when combining the constraint dropping with other changes in the same alter_table block.</p>
</li><li>
<p>The mysql adapter now supports the ruby-mysql 3 API (ruby-mysql is a pure-ruby MySQL driver).</p>
</li><li>
<p>The mysql adapter no longer uses the connection’s server_version method if it is defined, as the method does not return the correct value when using the ruby-mysql driver with MariaDB.</p>
</li><li>
<p>Comments added by the sql_comments extension no longer modify cached SQL for a dataset.</p>
</li></ul>

<h1 id="label-Other">Other<span><a href="#label-Other">&para;</a> <a href="#top">&uarr;</a></span></h1>
<ul><li>
<p>This is Sequel’s 250th release!</p>
</li></ul>
</div>
<div id='context'>
</div>

</div>
</div>

<div id='footer-push'></div>
</div>
<div id='footer'>
<a href="https://github.com/jeremyevans/hanna"><strong>Hanna</strong> RDoc template</a>
</div>
</body>
</html>
