<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
<head>
<title>Sequel::MSSQL::DatabaseMethods</title>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<link href='../../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
<script type='text/javascript'>
  function popupCode(url) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }
  
  function toggleCode(id) {
    var code = document.getElementById(id)
  
    code.style.display = code.style.display != 'block' ? 'block' : 'none'
    return true
  }
  
  // Make codeblocks hidden by default
  document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
</script>
</head>
<body class='page'>
<div class='class' id='wrapper'>
<div class='header'>
<h1 class='name'><span class='type'>module</span>
Sequel::MSSQL::DatabaseMethods
</h1>
<ol class='paths'>
<li>
<a href="../../../files/lib/sequel/adapters/shared/mssql_rb.html">lib/sequel/adapters/shared/mssql.rb</a>
</li>
</ol>
</div>
<div id='content'>
<div id='text'>
<div id='description'></div>
<div id='method-list'>
<h2>Methods</h2>
<h3>Public Instance</h3>
<ol>
<li><a href="#method-i-call_mssql_sproc">call_mssql_sproc</a></li>
<li><a href="#method-i-database_type">database_type</a></li>
<li><a href="#method-i-foreign_key_list">foreign_key_list</a></li>
<li><a href="#method-i-freeze">freeze</a></li>
<li><a href="#method-i-global_index_namespace-3F">global_index_namespace?</a></li>
<li><a href="#method-i-indexes">indexes</a></li>
<li><a href="#attribute-i-like_without_collate">like_without_collate</a></li>
<li><a href="#attribute-i-mssql_unicode_strings">mssql_unicode_strings</a></li>
<li><a href="#method-i-server_version">server_version</a></li>
<li><a href="#method-i-supports_partial_indexes-3F">supports_partial_indexes?</a></li>
<li><a href="#method-i-supports_savepoints-3F">supports_savepoints?</a></li>
<li><a href="#method-i-supports_transaction_isolation_levels-3F">supports_transaction_isolation_levels?</a></li>
<li><a href="#method-i-supports_transactional_ddl-3F">supports_transactional_ddl?</a></li>
<li><a href="#method-i-tables">tables</a></li>
<li><a href="#method-i-views">views</a></li>
</ol>
</div>
<div id='context'>
<div id='includes'>
<h2>Included modules</h2>
<ol>
<li><a href="../Database/SplitAlterTable.html">Sequel::Database::SplitAlterTable</a></li>
</ol>
</div>
</div>
<div id='section'>
<div id='constants-list'>
<h2>Constants</h2>
<div class='name-list'>
<table summary='Constants'>
<tr class='top-aligned-row context-row'>
<td class='context-item-name'>DATABASE_ERROR_REGEXPS</td>
<td>=</td>
<td class='context-item-value'>{
/Violation of UNIQUE KEY constraint|(Violation of PRIMARY KEY constraint.+)?Cannot insert duplicate key/ => UniqueConstraintViolation,
/conflicted with the (FOREIGN KEY.*|REFERENCE) constraint/ => ForeignKeyConstraintViolation,
/conflicted with the CHECK constraint/ => CheckConstraintViolation,
/column does not allow nulls/ => NotNullConstraintViolation,
/was deadlocked on lock resources with another process and has been chosen as the deadlock victim/ => SerializationFailure,
/Lock request time out period exceeded\./ => DatabaseLockTimeout,
}.freeze</td>
<td>&nbsp;</td>
<td class='context-item-desc'></td>
</tr>
<tr class='top-aligned-row context-row'>
<td class='context-item-name'>FOREIGN_KEY_ACTION_MAP</td>
<td>=</td>
<td class='context-item-value'>{0 => :no_action, 1 => :cascade, 2 => :set_null, 3 => :set_default}.freeze</td>
<td>&nbsp;</td>
<td class='context-item-desc'></td>
</tr>
</table>
</div>
</div>
<div id='attribute-list'>
<h2 class='section-bar'>Attributes</h2>
<div class='name-list'>
<table>
<tr class='top-aligned-row context-row'>
<td class='context-item-name'>
<a name='attribute-i-like_without_collate'>like_without_collate</a>
</td>
<td class='context-item-value'>[RW]</td>
<td class='context-item-desc'>
<p>Whether to use LIKE without COLLATE Latin1_General_CS_AS.  Skipping the COLLATE can significantly increase performance in some cases.</p>
</td>
</tr>
<tr class='top-aligned-row context-row'>
<td class='context-item-name'>
<a name='attribute-i-mssql_unicode_strings'>mssql_unicode_strings</a>
</td>
<td class='context-item-value'>[RW]</td>
<td class='context-item-desc'>
<p>Whether to use N‚Äù to quote strings, which allows unicode characters inside the strings.  True by default for compatibility, can be set to false for a possible performance increase.  This sets the default for all datasets created from this <a href="../Database.html"><code>Database</code></a> object.</p>
</td>
</tr>
</table>
</div>
</div>
<div id='methods'>
<h2>Public Instance methods</h2>
<div class='method public-instance' id='method-method-i-call_mssql_sproc'>
<a name='method-i-call_mssql_sproc'></a>
<div class='synopsis'>
<span class='name'>call_mssql_sproc</span><span class='arguments'>(name, opts=OPTS)</span>

</div>
<div class='description'>

<p>Execute the given stored procedure with the given name.</p>

<p>Options:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>:args </td><td>
<p>Arguments to stored procedure.  For named arguments, this should be a hash keyed by argument named.  For unnamed arguments, this should be an array.  Output parameters to the function are specified using :output. You can also name output parameters and provide a type by using an array containing :output, the type name, and the parameter name.</p>
</td></tr><tr><td class='label'>:server </td><td>
<p>The server/shard on which to execute the procedure.</p>
</td></tr></tbody></table>

<p>This method returns a single hash with the following keys:</p>
<table class="rdoc-list note-list"><tbody><tr><td class='label'>:result </td><td>
<p>The result code of the stored procedure</p>
</td></tr><tr><td class='label'>:numrows </td><td>
<p>The number of rows affected by the stored procedure</p>
</td></tr><tr><td class='label'>output params </td><td>
<p>Values for any output paramters, using the name given for the output parameter</p>
</td></tr></tbody></table>

<p>Because <a href="../../Sequel.html"><code>Sequel</code></a> datasets only support a single result set per query, and retrieving  the result code and number of rows requires a query, this does not support stored procedures which also return result sets.  To handle such stored procedures, you should drop down to the connection/driver level by using Sequel::Database#synchronize to get access to the underlying connection object.</p>

<p>Examples:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>.<span class="ruby-identifier">call_mssql_sproc</span>(<span class="ruby-value">:SequelTest</span>, {<span class="ruby-value">args:</span> [<span class="ruby-string">&#39;input arg&#39;</span>, <span class="ruby-value">:output</span>]})
<span class="ruby-constant">DB</span>.<span class="ruby-identifier">call_mssql_sproc</span>(<span class="ruby-value">:SequelTest</span>, {<span class="ruby-value">args:</span> [<span class="ruby-string">&#39;input arg&#39;</span>, [<span class="ruby-value">:output</span>, <span class="ruby-string">&#39;int&#39;</span>, <span class="ruby-string">&#39;varname&#39;</span>]]})

<span class="ruby-identifier">named</span> <span class="ruby-value">params:</span>
<span class="ruby-constant">DB</span>.<span class="ruby-identifier">call_mssql_sproc</span>(<span class="ruby-value">:SequelTest</span>, <span class="ruby-value">args:</span> {
  <span class="ruby-string">&#39;input_arg1_name&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;input arg1 value&#39;</span>,
  <span class="ruby-string">&#39;input_arg2_name&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;input arg2 value&#39;</span>,
  <span class="ruby-string">&#39;output_arg_name&#39;</span> <span class="ruby-operator">=&gt;</span> [<span class="ruby-value">:output</span>, <span class="ruby-string">&#39;int&#39;</span>, <span class="ruby-string">&#39;varname&#39;</span>]
})
</pre>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-call_mssql_sproc-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-call_mssql_sproc-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/mssql.rb</span>
<span class="line-num"> 64</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">call_mssql_sproc</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)
<span class="line-num"> 65</span>   <span class="ruby-identifier">args</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:args</span>] <span class="ruby-operator">||</span> []
<span class="line-num"> 66</span>   <span class="ruby-identifier">names</span> = [<span class="ruby-string">&#39;@RC AS RESULT&#39;</span>, <span class="ruby-string">&#39;@@ROWCOUNT AS NUMROWS&#39;</span>]
<span class="line-num"> 67</span>   <span class="ruby-identifier">declarations</span> = [<span class="ruby-string">&#39;@RC int&#39;</span>]
<span class="line-num"> 68</span>   <span class="ruby-identifier">values</span> = []
<span class="line-num"> 69</span> 
<span class="line-num"> 70</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>)
<span class="line-num"> 71</span>     <span class="ruby-identifier">named_args</span> = <span class="ruby-keyword">true</span>
<span class="line-num"> 72</span>     <span class="ruby-identifier">args</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">to_a</span>
<span class="line-num"> 73</span>     <span class="ruby-identifier">method</span> = <span class="ruby-value">:each</span>
<span class="line-num"> 74</span>   <span class="ruby-keyword">else</span>
<span class="line-num"> 75</span>     <span class="ruby-identifier">method</span> = <span class="ruby-value">:each_with_index</span>
<span class="line-num"> 76</span>   <span class="ruby-keyword">end</span>
<span class="line-num"> 77</span> 
<span class="line-num"> 78</span>   <span class="ruby-identifier">args</span>.<span class="ruby-identifier">public_send</span>(<span class="ruby-identifier">method</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">v</span>, <span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
<span class="line-num"> 79</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">named_args</span>
<span class="line-num"> 80</span>       <span class="ruby-identifier">k</span> = <span class="ruby-identifier">v</span>
<span class="line-num"> 81</span>       <span class="ruby-identifier">v</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">select</span> = <span class="ruby-identifier">i</span>
<span class="line-num"> 82</span>       <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-string">&quot;must provide output parameter name when using output parameters with named arguments&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">v</span> <span class="ruby-operator">==</span> <span class="ruby-value">:output</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">select</span>
<span class="line-num"> 83</span>     <span class="ruby-keyword">else</span>
<span class="line-num"> 84</span>       <span class="ruby-identifier">v</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">select</span> = <span class="ruby-identifier">v</span>
<span class="line-num"> 85</span>     <span class="ruby-keyword">end</span>
<span class="line-num"> 86</span> 
<span class="line-num"> 87</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">v</span> <span class="ruby-operator">==</span> <span class="ruby-value">:output</span>
<span class="line-num"> 88</span>       <span class="ruby-identifier">type</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;nvarchar(max)&quot;</span>
<span class="line-num"> 89</span>       <span class="ruby-keyword">if</span> <span class="ruby-identifier">named_args</span>
<span class="line-num"> 90</span>         <span class="ruby-identifier">varname</span> = <span class="ruby-identifier">select</span>
<span class="line-num"> 91</span>       <span class="ruby-keyword">else</span>
<span class="line-num"> 92</span>         <span class="ruby-identifier">varname</span> = <span class="ruby-node">&quot;var#{i}&quot;</span>
<span class="line-num"> 93</span>         <span class="ruby-identifier">select</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">varname</span>
<span class="line-num"> 94</span>       <span class="ruby-keyword">end</span>
<span class="line-num"> 95</span>       <span class="ruby-identifier">names</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;@#{varname} AS #{quote_identifier(select)}&quot;</span>
<span class="line-num"> 96</span>       <span class="ruby-identifier">declarations</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;@#{varname} #{type}&quot;</span>
<span class="line-num"> 97</span>       <span class="ruby-identifier">value</span> = <span class="ruby-node">&quot;@#{varname} OUTPUT&quot;</span>
<span class="line-num"> 98</span>     <span class="ruby-keyword">else</span>
<span class="line-num"> 99</span>       <span class="ruby-identifier">value</span> = <span class="ruby-identifier">literal</span>(<span class="ruby-identifier">v</span>)
<span class="line-num">100</span>     <span class="ruby-keyword">end</span>
<span class="line-num">101</span> 
<span class="line-num">102</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">named_args</span>
<span class="line-num">103</span>       <span class="ruby-identifier">value</span> = <span class="ruby-node">&quot;@#{k}=#{value}&quot;</span>
<span class="line-num">104</span>     <span class="ruby-keyword">end</span>
<span class="line-num">105</span> 
<span class="line-num">106</span>     <span class="ruby-identifier">values</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">value</span>
<span class="line-num">107</span>   <span class="ruby-keyword">end</span>
<span class="line-num">108</span> 
<span class="line-num">109</span>   <span class="ruby-identifier">sql</span> = <span class="ruby-node">&quot;DECLARE #{declarations.join(&#39;, &#39;)}; EXECUTE @RC = #{name} #{values.join(&#39;, &#39;)}; SELECT #{names.join(&#39;, &#39;)}&quot;</span>
<span class="line-num">110</span> 
<span class="line-num">111</span>   <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">with_sql</span>(<span class="ruby-identifier">sql</span>)
<span class="line-num">112</span>   <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">server</span>(<span class="ruby-identifier">opts</span>[<span class="ruby-value">:server</span>]) <span class="ruby-keyword">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:server</span>]
<span class="line-num">113</span>   <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">first</span>
<span class="line-num">114</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-database_type'>
<a name='method-i-database_type'></a>
<div class='synopsis'>
<span class='name'>database_type</span><span class='arguments'>()</span>

</div>
<div class='description'>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-database_type-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-database_type-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/mssql.rb</span>
<span class="line-num">116</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">database_type</span>
<span class="line-num">117</span>   <span class="ruby-value">:mssql</span>
<span class="line-num">118</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-foreign_key_list'>
<a name='method-i-foreign_key_list'></a>
<div class='synopsis'>
<span class='name'>foreign_key_list</span><span class='arguments'>(table, opts=OPTS)</span>

</div>
<div class='description'>

<p>Return foreign key information using the system views, including :name, :on_delete, and :on_update entries in the hashes.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-foreign_key_list-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-foreign_key_list-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/mssql.rb</span>
<span class="line-num">127</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">foreign_key_list</span>(<span class="ruby-identifier">table</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)
<span class="line-num">128</span>   <span class="ruby-identifier">m</span> = <span class="ruby-identifier">output_identifier_meth</span>
<span class="line-num">129</span>   <span class="ruby-identifier">im</span> = <span class="ruby-identifier">input_identifier_meth</span>
<span class="line-num">130</span>   <span class="ruby-identifier">schema</span>, <span class="ruby-identifier">table</span> = <span class="ruby-identifier">schema_and_table</span>(<span class="ruby-identifier">table</span>)
<span class="line-num">131</span>   <span class="ruby-identifier">current_schema</span> = <span class="ruby-identifier">m</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">get</span>(<span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">function</span>(<span class="ruby-string">&#39;schema_name&#39;</span>)))
<span class="line-num">132</span>   <span class="ruby-identifier">fk_action_map</span> = <span class="ruby-constant">FOREIGN_KEY_ACTION_MAP</span>
<span class="line-num">133</span>   <span class="ruby-identifier">fk</span> = <span class="ruby-constant">Sequel</span>[<span class="ruby-value">:fk</span>]
<span class="line-num">134</span>   <span class="ruby-identifier">fkc</span> = <span class="ruby-constant">Sequel</span>[<span class="ruby-value">:fkc</span>]
<span class="line-num">135</span>   <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">metadata_dataset</span>.<span class="ruby-identifier">from</span>(<span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">lit</span>(<span class="ruby-string">&#39;[sys].[foreign_keys]&#39;</span>).<span class="ruby-identifier">as</span>(<span class="ruby-value">:fk</span>)).
<span class="line-num">136</span>     <span class="ruby-identifier">join</span>(<span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">lit</span>(<span class="ruby-string">&#39;[sys].[foreign_key_columns]&#39;</span>).<span class="ruby-identifier">as</span>(<span class="ruby-value">:fkc</span>), <span class="ruby-value">:constraint_object_id</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-value">:object_id</span>).
<span class="line-num">137</span>     <span class="ruby-identifier">join</span>(<span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">lit</span>(<span class="ruby-string">&#39;[sys].[all_columns]&#39;</span>).<span class="ruby-identifier">as</span>(<span class="ruby-value">:pc</span>), <span class="ruby-value">:object_id</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">fkc</span>[<span class="ruby-value">:parent_object_id</span>],     <span class="ruby-value">:column_id</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">fkc</span>[<span class="ruby-value">:parent_column_id</span>]).
<span class="line-num">138</span>     <span class="ruby-identifier">join</span>(<span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">lit</span>(<span class="ruby-string">&#39;[sys].[all_columns]&#39;</span>).<span class="ruby-identifier">as</span>(<span class="ruby-value">:rc</span>), <span class="ruby-value">:object_id</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">fkc</span>[<span class="ruby-value">:referenced_object_id</span>], <span class="ruby-value">:column_id</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">fkc</span>[<span class="ruby-value">:referenced_column_id</span>]).
<span class="line-num">139</span>     <span class="ruby-identifier">where</span>{{<span class="ruby-identifier">object_schema_name</span>(<span class="ruby-identifier">fk</span>[<span class="ruby-value">:parent_object_id</span>]) <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">im</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">schema</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">current_schema</span>)}}.
<span class="line-num">140</span>     <span class="ruby-identifier">where</span>{{<span class="ruby-identifier">object_name</span>(<span class="ruby-identifier">fk</span>[<span class="ruby-value">:parent_object_id</span>]) <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">im</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">table</span>)}}.
<span class="line-num">141</span>     <span class="ruby-identifier">select</span>{[<span class="ruby-identifier">fk</span>[<span class="ruby-value">:name</span>], 
<span class="line-num">142</span>             <span class="ruby-identifier">fk</span>[<span class="ruby-value">:delete_referential_action</span>], 
<span class="line-num">143</span>             <span class="ruby-identifier">fk</span>[<span class="ruby-value">:update_referential_action</span>], 
<span class="line-num">144</span>             <span class="ruby-identifier">pc</span>[<span class="ruby-value">:name</span>].<span class="ruby-identifier">as</span>(<span class="ruby-value">:column</span>), 
<span class="line-num">145</span>             <span class="ruby-identifier">rc</span>[<span class="ruby-value">:name</span>].<span class="ruby-identifier">as</span>(<span class="ruby-value">:referenced_column</span>), 
<span class="line-num">146</span>             <span class="ruby-identifier">object_schema_name</span>(<span class="ruby-identifier">fk</span>[<span class="ruby-value">:referenced_object_id</span>]).<span class="ruby-identifier">as</span>(<span class="ruby-value">:schema</span>), 
<span class="line-num">147</span>             <span class="ruby-identifier">object_name</span>(<span class="ruby-identifier">fk</span>[<span class="ruby-value">:referenced_object_id</span>]).<span class="ruby-identifier">as</span>(<span class="ruby-value">:table</span>)]}.
<span class="line-num">148</span>     <span class="ruby-identifier">order</span>(<span class="ruby-identifier">fk</span>[<span class="ruby-value">:name</span>], <span class="ruby-identifier">fkc</span>[<span class="ruby-value">:constraint_column_id</span>])
<span class="line-num">149</span>   <span class="ruby-identifier">h</span> = {}
<span class="line-num">150</span>   <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span>
<span class="line-num">151</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span> = <span class="ruby-identifier">h</span>[<span class="ruby-identifier">row</span>[<span class="ruby-value">:name</span>]]
<span class="line-num">152</span>       <span class="ruby-identifier">r</span>[<span class="ruby-value">:columns</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">row</span>[<span class="ruby-value">:column</span>])
<span class="line-num">153</span>       <span class="ruby-identifier">r</span>[<span class="ruby-value">:key</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">row</span>[<span class="ruby-value">:referenced_column</span>])
<span class="line-num">154</span>     <span class="ruby-keyword">else</span>
<span class="line-num">155</span>       <span class="ruby-identifier">referenced_schema</span> = <span class="ruby-identifier">m</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">row</span>[<span class="ruby-value">:schema</span>])
<span class="line-num">156</span>       <span class="ruby-identifier">referenced_table</span> = <span class="ruby-identifier">m</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">row</span>[<span class="ruby-value">:table</span>])
<span class="line-num">157</span>       <span class="ruby-identifier">h</span>[<span class="ruby-identifier">row</span>[<span class="ruby-value">:name</span>]] = { <span class="ruby-value">:name</span>      <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">row</span>[<span class="ruby-value">:name</span>]), 
<span class="line-num">158</span>                         <span class="ruby-value">:table</span>     <span class="ruby-operator">=&gt;</span> (<span class="ruby-identifier">referenced_schema</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">current_schema</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">referenced_table</span> <span class="ruby-operator">:</span> <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">qualify</span>(<span class="ruby-identifier">referenced_schema</span>, <span class="ruby-identifier">referenced_table</span>),
<span class="line-num">159</span>                         <span class="ruby-value">:columns</span>   <span class="ruby-operator">=&gt;</span> [<span class="ruby-identifier">m</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">row</span>[<span class="ruby-value">:column</span>])], 
<span class="line-num">160</span>                         <span class="ruby-value">:key</span>       <span class="ruby-operator">=&gt;</span> [<span class="ruby-identifier">m</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">row</span>[<span class="ruby-value">:referenced_column</span>])], 
<span class="line-num">161</span>                         <span class="ruby-value">:on_update</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">fk_action_map</span>[<span class="ruby-identifier">row</span>[<span class="ruby-value">:update_referential_action</span>]], 
<span class="line-num">162</span>                         <span class="ruby-value">:on_delete</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">fk_action_map</span>[<span class="ruby-identifier">row</span>[<span class="ruby-value">:delete_referential_action</span>]] }
<span class="line-num">163</span>     <span class="ruby-keyword">end</span>
<span class="line-num">164</span>   <span class="ruby-keyword">end</span>
<span class="line-num">165</span>   <span class="ruby-identifier">h</span>.<span class="ruby-identifier">values</span>
<span class="line-num">166</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-freeze'>
<a name='method-i-freeze'></a>
<div class='synopsis'>
<span class='name'>freeze</span><span class='arguments'>()</span>

</div>
<div class='description'>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-freeze-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-freeze-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/mssql.rb</span>
<span class="line-num">168</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">freeze</span>
<span class="line-num">169</span>   <span class="ruby-identifier">server_version</span>
<span class="line-num">170</span>   <span class="ruby-keyword">super</span>
<span class="line-num">171</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-global_index_namespace-3F'>
<a name='method-i-global_index_namespace-3F'></a>
<div class='synopsis'>
<span class='name'>global_index_namespace?</span><span class='arguments'>()</span>

</div>
<div class='description'>

<p>Microsoft SQL Server namespaces indexes per table.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-global_index_namespace-3F-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-global_index_namespace-3F-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/mssql.rb</span>
<span class="line-num">121</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">global_index_namespace?</span>
<span class="line-num">122</span>   <span class="ruby-keyword">false</span>
<span class="line-num">123</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-indexes'>
<a name='method-i-indexes'></a>
<div class='synopsis'>
<span class='name'>indexes</span><span class='arguments'>(table, opts=OPTS)</span>

</div>
<div class='description'>

<p>Use the system tables to get index information</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-indexes-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-indexes-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/mssql.rb</span>
<span class="line-num">174</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">indexes</span>(<span class="ruby-identifier">table</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)
<span class="line-num">175</span>   <span class="ruby-identifier">m</span> = <span class="ruby-identifier">output_identifier_meth</span>
<span class="line-num">176</span>   <span class="ruby-identifier">im</span> = <span class="ruby-identifier">input_identifier_meth</span>
<span class="line-num">177</span>   <span class="ruby-identifier">indexes</span> = {}
<span class="line-num">178</span>   <span class="ruby-identifier">table</span> = <span class="ruby-identifier">table</span>.<span class="ruby-identifier">value</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">table</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Sequel</span><span class="ruby-operator">::</span><span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">Identifier</span>)
<span class="line-num">179</span>   <span class="ruby-identifier">i</span> = <span class="ruby-constant">Sequel</span>[<span class="ruby-value">:i</span>]
<span class="line-num">180</span>   <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">metadata_dataset</span>.<span class="ruby-identifier">from</span>(<span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">lit</span>(<span class="ruby-string">&#39;[sys].[tables]&#39;</span>).<span class="ruby-identifier">as</span>(<span class="ruby-value">:t</span>)).
<span class="line-num">181</span>    <span class="ruby-identifier">join</span>(<span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">lit</span>(<span class="ruby-string">&#39;[sys].[indexes]&#39;</span>).<span class="ruby-identifier">as</span>(<span class="ruby-value">:i</span>), <span class="ruby-value">:object_id</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">:object_id</span>).
<span class="line-num">182</span>    <span class="ruby-identifier">join</span>(<span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">lit</span>(<span class="ruby-string">&#39;[sys].[index_columns]&#39;</span>).<span class="ruby-identifier">as</span>(<span class="ruby-value">:ic</span>), <span class="ruby-value">:object_id</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">:object_id</span>, <span class="ruby-value">:index_id</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">:index_id</span>).
<span class="line-num">183</span>    <span class="ruby-identifier">join</span>(<span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">lit</span>(<span class="ruby-string">&#39;[sys].[columns]&#39;</span>).<span class="ruby-identifier">as</span>(<span class="ruby-value">:c</span>), <span class="ruby-value">:object_id</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">:object_id</span>, <span class="ruby-value">:column_id</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">:column_id</span>).
<span class="line-num">184</span>    <span class="ruby-identifier">select</span>(<span class="ruby-identifier">i</span>[<span class="ruby-value">:name</span>], <span class="ruby-identifier">i</span>[<span class="ruby-value">:is_unique</span>], <span class="ruby-constant">Sequel</span>[<span class="ruby-value">:c</span>][<span class="ruby-value">:name</span>].<span class="ruby-identifier">as</span>(<span class="ruby-value">:column</span>)).
<span class="line-num">185</span>    <span class="ruby-identifier">where</span>{{<span class="ruby-identifier">t</span>[<span class="ruby-value">:name</span>]<span class="ruby-operator">=&gt;</span><span class="ruby-identifier">im</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">table</span>)}}.
<span class="line-num">186</span>    <span class="ruby-identifier">where</span>(<span class="ruby-identifier">i</span>[<span class="ruby-value">:is_primary_key</span>]<span class="ruby-operator">=&gt;</span><span class="ruby-value">0</span>, <span class="ruby-identifier">i</span>[<span class="ruby-value">:is_disabled</span>]<span class="ruby-operator">=&gt;</span><span class="ruby-value">0</span>).
<span class="line-num">187</span>    <span class="ruby-identifier">order</span>(<span class="ruby-identifier">i</span>[<span class="ruby-value">:name</span>], <span class="ruby-constant">Sequel</span>[<span class="ruby-value">:ic</span>][<span class="ruby-value">:index_column_id</span>])
<span class="line-num">188</span> 
<span class="line-num">189</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">supports_partial_indexes?</span>
<span class="line-num">190</span>     <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">i</span>[<span class="ruby-value">:has_filter</span>]<span class="ruby-operator">=&gt;</span><span class="ruby-value">0</span>)
<span class="line-num">191</span>   <span class="ruby-keyword">end</span>
<span class="line-num">192</span> 
<span class="line-num">193</span>   <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span>
<span class="line-num">194</span>     <span class="ruby-identifier">index</span> = <span class="ruby-identifier">indexes</span>[<span class="ruby-identifier">m</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">r</span>[<span class="ruby-value">:name</span>])] <span class="ruby-operator">||=</span> {<span class="ruby-value">:columns</span><span class="ruby-operator">=&gt;</span>[], <span class="ruby-value">:unique</span><span class="ruby-operator">=&gt;</span>(<span class="ruby-identifier">r</span>[<span class="ruby-value">:is_unique</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">r</span>[<span class="ruby-value">:is_unique</span>]<span class="ruby-operator">!=</span><span class="ruby-value">0</span>)}
<span class="line-num">195</span>     <span class="ruby-identifier">index</span>[<span class="ruby-value">:columns</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">r</span>[<span class="ruby-value">:column</span>])
<span class="line-num">196</span>   <span class="ruby-keyword">end</span>
<span class="line-num">197</span>   <span class="ruby-identifier">indexes</span>
<span class="line-num">198</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-server_version'>
<a name='method-i-server_version'></a>
<div class='synopsis'>
<span class='name'>server_version</span><span class='arguments'>(server=nil)</span>

</div>
<div class='description'>

<p>The version of the <a href="../MSSQL.html"><code>MSSQL</code></a> server, as an integer (e.g. 10001600 for SQL Server 2008 Express).</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-server_version-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-server_version-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/mssql.rb</span>
<span class="line-num">202</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">server_version</span>(<span class="ruby-identifier">server</span>=<span class="ruby-keyword">nil</span>)
<span class="line-num">203</span>   <span class="ruby-keyword">return</span> <span class="ruby-ivar">@server_version</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@server_version</span>
<span class="line-num">204</span>   <span class="ruby-keyword">if</span> <span class="ruby-ivar">@opts</span>[<span class="ruby-value">:server_version</span>]
<span class="line-num">205</span>     <span class="ruby-keyword">return</span> <span class="ruby-ivar">@server_version</span> = <span class="ruby-constant">Integer</span>(<span class="ruby-ivar">@opts</span>[<span class="ruby-value">:server_version</span>])
<span class="line-num">206</span>   <span class="ruby-keyword">end</span>
<span class="line-num">207</span>   <span class="ruby-ivar">@server_version</span> = <span class="ruby-identifier">synchronize</span>(<span class="ruby-identifier">server</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">conn</span><span class="ruby-operator">|</span>
<span class="line-num">208</span>     (<span class="ruby-identifier">conn</span>.<span class="ruby-identifier">server_version</span> <span class="ruby-keyword">rescue</span> <span class="ruby-keyword">nil</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:server_version</span>)
<span class="line-num">209</span>   <span class="ruby-keyword">end</span>
<span class="line-num">210</span>   <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@server_version</span>
<span class="line-num">211</span>     <span class="ruby-identifier">m</span> = <span class="ruby-regexp">/^(\d+)\.(\d+)\.(\d+)/</span>.<span class="ruby-identifier">match</span>(<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&quot;SELECT CAST(SERVERPROPERTY(&#39;ProductVersion&#39;) AS varchar)&quot;</span>).<span class="ruby-identifier">single_value</span>.<span class="ruby-identifier">to_s</span>)
<span class="line-num">212</span>     <span class="ruby-ivar">@server_version</span> = (<span class="ruby-identifier">m</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-operator">*</span> <span class="ruby-value">1000000</span>) <span class="ruby-operator">+</span> (<span class="ruby-identifier">m</span>[<span class="ruby-value">2</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-operator">*</span> <span class="ruby-value">10000</span>) <span class="ruby-operator">+</span> <span class="ruby-identifier">m</span>[<span class="ruby-value">3</span>].<span class="ruby-identifier">to_i</span>
<span class="line-num">213</span>   <span class="ruby-keyword">end</span>
<span class="line-num">214</span>   <span class="ruby-ivar">@server_version</span>
<span class="line-num">215</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-supports_partial_indexes-3F'>
<a name='method-i-supports_partial_indexes-3F'></a>
<div class='synopsis'>
<span class='name'>supports_partial_indexes?</span><span class='arguments'>()</span>

</div>
<div class='description'>

<p><a href="../MSSQL.html"><code>MSSQL</code></a> 2008+ supports partial indexes.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-supports_partial_indexes-3F-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-supports_partial_indexes-3F-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/mssql.rb</span>
<span class="line-num">218</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_partial_indexes?</span>
<span class="line-num">219</span>   <span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">send</span>(<span class="ruby-value">:is_2008_or_later?</span>)
<span class="line-num">220</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-supports_savepoints-3F'>
<a name='method-i-supports_savepoints-3F'></a>
<div class='synopsis'>
<span class='name'>supports_savepoints?</span><span class='arguments'>()</span>

</div>
<div class='description'>

<p><a href="../MSSQL.html"><code>MSSQL</code></a> supports savepoints, though it doesn‚Äôt support releasing them</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-supports_savepoints-3F-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-supports_savepoints-3F-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/mssql.rb</span>
<span class="line-num">223</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_savepoints?</span>
<span class="line-num">224</span>   <span class="ruby-keyword">true</span>
<span class="line-num">225</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-supports_transaction_isolation_levels-3F'>
<a name='method-i-supports_transaction_isolation_levels-3F'></a>
<div class='synopsis'>
<span class='name'>supports_transaction_isolation_levels?</span><span class='arguments'>()</span>

</div>
<div class='description'>

<p><a href="../MSSQL.html"><code>MSSQL</code></a> supports transaction isolation levels</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-supports_transaction_isolation_levels-3F-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-supports_transaction_isolation_levels-3F-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/mssql.rb</span>
<span class="line-num">228</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_transaction_isolation_levels?</span>
<span class="line-num">229</span>   <span class="ruby-keyword">true</span>
<span class="line-num">230</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-supports_transactional_ddl-3F'>
<a name='method-i-supports_transactional_ddl-3F'></a>
<div class='synopsis'>
<span class='name'>supports_transactional_ddl?</span><span class='arguments'>()</span>

</div>
<div class='description'>

<p><a href="../MSSQL.html"><code>MSSQL</code></a> supports transaction DDL statements.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-supports_transactional_ddl-3F-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-supports_transactional_ddl-3F-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/mssql.rb</span>
<span class="line-num">233</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_transactional_ddl?</span>
<span class="line-num">234</span>   <span class="ruby-keyword">true</span>
<span class="line-num">235</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-tables'>
<a name='method-i-tables'></a>
<div class='synopsis'>
<span class='name'>tables</span><span class='arguments'>(opts=OPTS)</span>

</div>
<div class='description'>

<p>Microsoft SQL Server supports using the INFORMATION_SCHEMA to get information on tables.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-tables-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-tables-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/mssql.rb</span>
<span class="line-num">239</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">tables</span>(<span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)
<span class="line-num">240</span>   <span class="ruby-identifier">information_schema_tables</span>(<span class="ruby-string">&#39;BASE TABLE&#39;</span>, <span class="ruby-identifier">opts</span>)
<span class="line-num">241</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
<div class='method public-instance' id='method-method-i-views'>
<a name='method-i-views'></a>
<div class='synopsis'>
<span class='name'>views</span><span class='arguments'>(opts=OPTS)</span>

</div>
<div class='description'>

<p>Microsoft SQL Server supports using the INFORMATION_SCHEMA to get information on views.</p>

</div>
<div class='source'>
<a class='source-toggle' href='#' onclick='toggleCode(&#39;method-i-views-source&#39;); return false'>
[show source]
</a>
<pre id='method-i-views-source'>    <span class="ruby-comment"># File lib/sequel/adapters/shared/mssql.rb</span>
<span class="line-num">245</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">views</span>(<span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)
<span class="line-num">246</span>   <span class="ruby-identifier">information_schema_tables</span>(<span class="ruby-string">&#39;VIEW&#39;</span>, <span class="ruby-identifier">opts</span>)
<span class="line-num">247</span> <span class="ruby-keyword">end</span></pre>
</div>
</div>
</div>
</div>

</div>
</div>

<div id='footer-push'></div>
</div>
<div id='footer'>
<a href="https://github.com/jeremyevans/hanna-nouveau"><strong>Hanna Nouveau</strong> RDoc template</a>
</div>
</body>
</html>
